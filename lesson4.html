
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dangerous Maze - Buá»•i 4</title>
  <link rel="stylesheet" href="style.css" />
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({
      startOnLoad: true,
      theme: "dark",
      themeVariables: {
        primaryColor: "#111827",
        primaryBorderColor: "#22d3ee",
        primaryTextColor: "#e5e7eb",
        lineColor: "#22d3ee",
        secondaryColor: "#0b1222",
        tertiaryColor: "#0b1222",
        fontFamily: "system-ui, Segoe UI, Roboto, Helvetica, Arial",
        fontSize: "16px",
        labelBackground: "#1f2937",
        labelTextColor: "#e5e7eb",
        nodeBorder: "#22d3ee",
        clusterBackground: "#0b1222",
        clusterBorder: "#22d3ee"
      }
    });
  </script>
</head>
<body>
  <main class="wrap">
    <nav class="breadcrumb">
      <a href="index.html">ğŸ  Trang chá»§</a> > <span>Buá»•i 4</span>
    </nav>

    <h1>ğŸ® Dangerous Maze - Buá»•i 4</h1>

    <!-- 1) Má»¥c tiÃªu -->
    <section class="card">
      <h2>1) ğŸ¯ Má»¥c tiÃªu buá»•i há»c</h2>
      <p>XÃ¢y dá»±ng trÃ² chÆ¡i mÃª cung nÆ¡i ngÆ°á»i chÆ¡i Ä‘iá»u khiá»ƒn nhÃ¢n váº­t vÆ°á»£t tÆ°á»ng vÃ  báº«y Ä‘á»ƒ Ä‘áº¿n Ä‘Ã­ch an toÃ n.</p>
      <ul class="tips">
        <li><strong>Hiá»ƒu</strong> cÃ¡ch dÃ¹ng <em>Room</em> Ä‘á»ƒ bá»‘ trÃ­ mÃª cung.</li>
        <li><strong>Thá»±c hÃ nh</strong> Ä‘iá»u khiá»ƒn nhÃ¢n váº­t báº±ng bÃ n phÃ­m, kiá»ƒm tra va cháº¡m.</li>
        <li><strong>Ãp dá»¥ng</strong> <code>place_meeting()</code> Ä‘á»ƒ di chuyá»ƒn mÆ°á»£t vÃ  khÃ´ng xuyÃªn tÆ°á»ng.</li>
        <li><strong>Sá»­ dá»¥ng</strong> <em>Tileset</em> Ä‘á»ƒ dá»±ng báº£n Ä‘á»“ nhanh, Ä‘áº¹p vÃ  dá»… chá»‰nh sá»­a.</li>
      </ul>
    </section>

    <!-- 2) Flowchart -->
    <section class="card">
      <h2>2) ğŸ” Luá»“ng hoáº¡t Ä‘á»™ng cá»§a game</h2>
      <div class="mermaid">
flowchart TD
  A["ğŸš€ Báº¯t Ä‘áº§u game"] --> B["ğŸ¨ Chuáº©n bá»‹ sprite, object, tileset"]
  B --> C["ğŸ—ï¸ Váº½ mÃª cung trong Room (Tiles)"]
  C --> D["ğŸ® Äiá»u khiá»ƒn nhÃ¢n váº­t"]
  D --> E{"â“ Va cháº¡m gÃ¬?"}
  E -->|ğŸ§± TÆ°á»ng| F["â›” Cháº·n láº¡i (khÃ´ng xuyÃªn)"]
  E -->|âš ï¸ Báº«y| G["ğŸ’€ Thua â†’ Restart"]
  E -->|ğŸ ÄÃ­ch| H["ğŸ† Tháº¯ng â†’ Restart/Next"]
  F --> D
  G --> D
  H --> D
      </div>
      <p class="note">ğŸ“Œ Náº¿u sÆ¡ Ä‘á»“ khÃ´ng hiá»‡n, kiá»ƒm tra máº¡ng (cáº§n táº£i Mermaid) hoáº·c thá»­ trÃ¬nh duyá»‡t khÃ¡c.</p>
    </section>

    <!-- 3) Chuáº©n bá»‹ tÃ i nguyÃªn -->
    <section class="card">
      <h2>3) ğŸ§° Chuáº©n bá»‹ tÃ i nguyÃªn</h2>
      <h3>a) Sprites & Objects</h3>
      <ul class="tips">
        <li><strong>spr_player</strong> â†’ <em>obj_player</em>: nhÃ¢n váº­t chÃ­nh.</li>
        <li><strong>spr_wall</strong> â†’ <em>obj_wall</em>: tÆ°á»ng cáº£n Ä‘Æ°á»ng.</li>
        <li><strong>spr_trap</strong> â†’ <em>obj_trap</em>: báº«y nguy hiá»ƒm.</li>
        <li><strong>spr_goal</strong> â†’ <em>obj_goal</em>: Ä‘iá»ƒm Ä‘Ã­ch.</li>
      </ul>

      <h3>b) Room & Layout</h3>
      <ul class="tips">
        <li>Táº¡o <strong>Room</strong> (vÃ­ dá»¥: <code>rm_maze</code>) kÃ­ch thÆ°á»›c phÃ¹ há»£p mÃ n hÃ¬nh.</li>
        <li>Sáº¯p xáº¿p <em>obj_wall</em>, <em>obj_trap</em>, <em>obj_goal</em> thÃ nh lá»‘i Ä‘i há»£p lÃ½.</li>
        <li>Äáº·t <em>obj_player</em> táº¡i vá»‹ trÃ­ báº¯t Ä‘áº§u.</li>
      </ul>
    </section>

    <!-- 4) Di chuyá»ƒn vá»›i place_meeting -->
    <section class="card">
      <h2>4) ğŸ® Di chuyá»ƒn nhÃ¢n váº­t báº±ng <code>place_meeting()</code></h2>
      <p><code>place_meeting(nx, ny, obj)</code> kiá»ƒm tra <em>náº¿u Ä‘áº·t hitbox</em> cá»§a instance hiá»‡n táº¡i á»Ÿ vá»‹ trÃ­ <code>(nx, ny)</code> thÃ¬ cÃ³ cháº¡m vÃ o báº¥t ká»³ instance nÃ o cá»§a <code>obj</code> khÃ´ng. HÃ m nÃ y <strong>khÃ´ng tá»± di chuyá»ƒn</strong>; báº¡n cáº§n gÃ¡n toáº¡ Ä‘á»™ náº¿u an toÃ n.</p>
      <h3>a) DÃ¹ng â€œÄ‘Ãºng chuáº©nâ€ (tÃ¡ch trá»¥c & kiá»ƒm tra trÆ°á»›c khi gÃ¡n)</h3>
      <pre><code>/// Step Event - obj_player
var spd = 4;
var h = keyboard_check(vk_right) - keyboard_check(vk_left);
var v = keyboard_check(vk_down)  - keyboard_check(vk_up);

// Trá»¥c X
if (h != 0) {
    var nx = x + h * spd;
    if (!place_meeting(nx, y, obj_wall)) {
        x = nx;
    }
}

// Trá»¥c Y
if (v != 0) {
    var ny = y + v * spd;
    if (!place_meeting(x, ny, obj_wall)) {
        y = ny;
    }
}</code></pre>

      <h3>b) Di chuyá»ƒn chÃ©o mÆ°á»£t hÆ¡n (chuáº©n hÃ³a váº­n tá»‘c)</h3>
      <pre><code>var spd = 4;
var dx  = keyboard_check(vk_right) - keyboard_check(vk_left);
var dy  = keyboard_check(vk_down)  - keyboard_check(vk_up);

// Chuáº©n hÃ³a Ä‘á»ƒ chÃ©o khÃ´ng nhanh hÆ¡n
if (dx != 0 || dy != 0) {
    var len = point_distance(0, 0, dx, dy);
    dx /= len; dy /= len;
}

var nx = x + dx * spd;
if (!place_meeting(nx, y, obj_wall)) x = nx;

var ny = y + dy * spd;
if (!place_meeting(x, ny, obj_wall)) y = ny;</code></pre>

      <h3>c) â€œBÆ°á»›c sÃ¡t tÆ°á»ngâ€ (trÆ°á»£t Ä‘áº¿n cáº¡nh theo tá»«ng pixel)</h3>
      <pre><code>/// Move toward target on one axis by 1px steps until blocked
function move_axis_safely(target, axis_is_x) {
    var step = (target - (axis_is_x ? x : y));
    var sgn  = sign(step);
    while (step != 0) {
        var nx = x + (axis_is_x ? sgn : 0);
        var ny = y + (axis_is_x ? 0   : sgn);
        if (!place_meeting(nx, ny, obj_wall)) {
            x = nx; y = ny;
            step -= sgn;
        } else break;
    }
}

// VÃ­ dá»¥ dÃ¹ng trong Step:
move_axis_safely(x + dx * spd, true);
move_axis_safely(y + dy * spd, false);</code></pre>

      <h3>d) Lá»—i thÆ°á»ng gáº·p & cÃ¡ch sá»­a</h3>
      <ul class="tips">
        <li>Gá»i <code>place_meeting(x, y, obj_wall)</code> <em>sau khi</em> Ä‘Ã£ Ä‘á»•i <code>x/y</code> â†’ HÃ£y kiá»ƒm tra <strong>trÆ°á»›c</strong>, rá»“i má»›i gÃ¡n.</li>
        <li>Sprite cÃ³ khoáº£ng trá»‘ng lÃ m mask lá»‡ch â†’ chá»‰nh <strong>Origin, Separate Collision Mask</strong> hoáº·c dÃ¹ng <code>mask_index</code> riÃªng.</li>
        <li>Äáº·t <em>solid</em> cho <code>obj_wall</code> vÃ  vá»«a code va cháº¡m â†’ xung Ä‘á»™t. Khuyáº¿n nghá»‹: bá» <em>solid</em>, chá»‰ dÃ¹ng code.</li>
      </ul>
    </section>

    <!-- 5) Va cháº¡m & tráº¡ng thÃ¡i -->
    <section class="card">
      <h2>5) âš ï¸ Va cháº¡m & tráº¡ng thÃ¡i tháº¯ng/thua</h2>
      <h3>a) Thua khi cháº¡m báº«y</h3>
      <pre><code>/// Collision Event (obj_player with obj_trap)
show_message("ğŸ’€ Báº¡n Ä‘Ã£ thua! Thá»­ láº¡i nhÃ©.");
game_restart();</code></pre>

      <h3>b) Tháº¯ng khi cháº¡m Ä‘Ã­ch</h3>
      <pre><code>/// Collision Event (obj_player with obj_goal)
show_message("ğŸ† ChÃºc má»«ng! Báº¡n Ä‘Ã£ Ä‘áº¿n Ä‘Ã­ch!");
game_restart(); // hoáº·c room_goto_next();</code></pre>
    </section>

    <!-- 6) Tileset & Tile Collision -->
    <section class="card">
      <h2>6) ğŸ§± Tileset & xÃ¢y dá»±ng báº£n Ä‘á»“ mÃª cung</h2>

      <h3>a) Tileset lÃ  gÃ¬?</h3>
      <p><strong>Tileset</strong> lÃ  má»™t áº£nh chá»©a nhiá»u Ã´ nhá» (tile) cÃ³ kÃ­ch thÆ°á»›c Ä‘á»u (vÃ­ dá»¥ 32Ã—32). Khi vÃ o Room Editor, báº¡n váº½ cÃ¡c Ã´ nÃ y lÃªn <em>Tile Layer</em> Ä‘á»ƒ táº¡o ná»n hoáº·c tÆ°á»ng. LÆ°u Ã½: <strong>tile máº·c Ä‘á»‹nh khÃ´ng cÃ³ va cháº¡m</strong>.</p>

      <h3>b) Quy trÃ¬nh táº¡o Tileset & váº½ map</h3>
      <ul class="tips">
        <li>Chuáº©n bá»‹ áº£nh PNG theo lÆ°á»›i (16/32/48 px).</li>
        <li>Trong IDE: <em>Create â†’ Tileset</em> â†’ chá»n áº£nh â†’ Ä‘áº·t <strong>Tile width/height</strong> khá»›p kÃ­ch thÆ°á»›c.</li>
        <li>Má»Ÿ <strong>Room</strong> â†’ tab <strong>Tiles</strong> â†’ chá»n Tileset â†’ <strong>váº½</strong> tÆ°á»ng/ná»n theo lÆ°á»›i.</li>
        <li>(TÃ¹y chá»n) Cáº¥u hÃ¬nh <em>Auto-Tile</em> Ä‘á»ƒ váº½ bo gÃ³c/viá»n nhanh.</li>
      </ul>

      <h3>c) LÃ m sao Ä‘á»ƒ tile â€œcháº·nâ€ nhÃ¢n váº­t?</h3>
      <p>VÃ¬ tile chá»‰ hiá»ƒn thá»‹, báº¡n cÃ³ 2 cÃ¡ch phá»• biáº¿n Ä‘á»ƒ táº¡o va cháº¡m:</p>

      <h4>â€¢ CÃ¡ch 1 â€” ÄÆ¡n giáº£n (khuyáº¿n nghá»‹ cho cáº¥p 2): <em>Äáº·t obj_wall vÃ´ hÃ¬nh trÃ¹ng vá»›i tiles</em></h4>
      <ul class="tips">
        <li>Váº½ map báº±ng Tiles cho Ä‘áº¹p vÃ  nhanh.</li>
        <li>Tháº£ cÃ¡c instance <code>obj_wall</code> phá»§ lÃªn vÃ¹ng tÆ°á»ng (snap grid 32Ã—32).</li>
        <li>Kiá»ƒm tra va cháº¡m báº±ng <code>place_meeting(..., obj_wall)</code>.</li>
      </ul>

      <h4>â€¢ CÃ¡ch 2 â€” NÃ¢ng cao: <em>DÃ¹ng Tilemap API Ä‘á»ƒ coi tile lÃ  â€œsolidâ€</em></h4>
      <p>Ã tÆ°á»Ÿng: láº¥y tile á»Ÿ pixel sáº¯p di chuyá»ƒn Ä‘áº¿n; náº¿u cÃ³ tile trÃªn layer tÆ°á»ng thÃ¬ cháº·n.</p>
      <pre><code>/// Create Event (obj_player)
// Äáº·t Ä‘Ãºng tÃªn layer tile tÆ°á»ng trong Room
tile_layer_id = layer_get_id("Tiles_Wall");
tilemap_id    = layer_tilemap_get_id(tile_layer_id);
tile_w = 32; tile_h = 32;

// Kiá»ƒm tra cÃ³ tile táº¡i pixel?
function solid_at_pixel(px, py) {
    var t = tilemap_get_at_pixel(tilemap_id, px, py);
    return (t != 0); // 0 = rá»—ng, !=0 = cÃ³ tile
}</code></pre>

      <p>Di chuyá»ƒn an toÃ n vá»›i tilemap (tÃ¡ch trá»¥c):</p>
      <pre><code>/// Step Event (obj_player)
var spd = 4;
var dx  = keyboard_check(vk_right) - keyboard_check(vk_left);
var dy  = keyboard_check(vk_down)  - keyboard_check(vk_up);

if (dx != 0 || dy != 0) {
    var len = point_distance(0,0,dx,dy);
    dx /= len; dy /= len;
}

// Trá»¥c X
var nx = x + dx * spd;
if (!solid_at_pixel(nx, y)) x = nx;

// Trá»¥c Y
var ny = y + dy * spd;
if (!solid_at_pixel(x, ny)) y = ny;</code></pre>

      <p>Kiá»ƒm tra sÃ¡t cáº¡nh chuáº©n hÆ¡n (4 gÃ³c hitbox):</p>
      <pre><code>function blocked_rect(nx, ny, half_w, half_h) {
    return solid_at_pixel(nx - half_w, ny - half_h)
        || solid_at_pixel(nx + half_w, ny - half_h)
        || solid_at_pixel(nx - half_w, ny + half_h)
        || solid_at_pixel(nx + half_w, ny + half_h);
}

// VÃ­ dá»¥ dÃ¹ng:
// if (!blocked_rect(nx, y, 8, 10)) x = nx;
// if (!blocked_rect(x, ny, 8, 10)) y = ny;</code></pre>

      <h3>d) So sÃ¡nh nhanh 2 cÃ¡ch</h3>
      <table>
        <tr><th>TiÃªu chÃ­</th><th>CÃ¡ch 1: obj_wall vÃ´ hÃ¬nh</th><th>CÃ¡ch 2: Tilemap API</th></tr>
        <tr><td>Äá»™ khÃ³</td><td>Dá»… (phÃ¹ há»£p cáº¥p 2)</td><td>Trung bÃ¬nh â€“ nÃ¢ng cao</td></tr>
        <tr><td>Hiá»‡u suáº¥t</td><td>Tá»‘t</td><td>Ráº¥t tá»‘t</td></tr>
        <tr><td>Äá»™ chÃ­nh xÃ¡c</td><td>Cao náº¿u bÃ¡m grid</td><td>Cao (cáº§n code hitbox)</td></tr>
        <tr><td>Chá»‰nh map</td><td>Váº½ Tiles + tháº£ wall</td><td>Váº½ Tiles (khÃ´ng cáº§n wall)</td></tr>
      </table>

      <h3>e) Lá»—i thÆ°á»ng gáº·p vá»›i Tiles & máº¹o</h3>
      <ul class="tips">
        <li>Tiles khÃ´ng cháº·n Ä‘Æ°á»£c nhÃ¢n váº­t â†’ VÃ¬ tile khÃ´ng collision. HÃ£y dÃ¹ng CÃ¡ch 1 hoáº·c CÃ¡ch 2.</li>
        <li>Lá»‡ch lÆ°á»›i (sprite/mask khÃ´ng khá»›p 32Ã—32) â†’ Chá»‰nh grid & mask cho trÃ¹ng.</li>
        <li>Sai tÃªn layer khi dÃ¹ng Tilemap API â†’ Kiá»ƒm tra Ä‘Ãºng tÃªn (vÃ­ dá»¥: <code>"Tiles_Wall"</code>).</li>
        <li>Origin sprite khÃ´ng há»£p lÃ½ â†’ Äáº·t center/bottom-center Ä‘á»ƒ hitbox á»•n Ä‘á»‹nh.</li>
      </ul>

      <h3>f) Checklist xÃ¢y map nhanh â€“ gá»n â€“ Ä‘Ãºng</h3>
      <ul class="tips">
        <li>[ ] áº¢nh tiles cáº¯t Ä‘Ãºng kÃ­ch thÆ°á»›c (16/32/48 px).</li>
        <li>[ ] Room báº­t grid Ä‘Ãºng size (vÃ­ dá»¥ 32Ã—32).</li>
        <li>[ ] Váº½ ná»n vÃ  tÆ°á»ng báº±ng Tiles.</li>
        <li>[ ] Chá»n 1 cÃ¡ch collision: <em>obj_wall</em> hoáº·c <em>Tilemap API</em> (khÃ´ng trá»™n lung tung).</li>
        <li>[ ] Test: Ä‘i sÃ¡t tÆ°á»ng/bÃ¡m gÃ³c, cháº¡m báº«y/Ä‘Ã­ch.</li>
      </ul>
    </section>

    <!-- 7) Máº¹o trÃ¡nh lá»—i -->
    <section class="card">
      <h2>7) ğŸ’¡ Máº¹o trÃ¡nh lá»—i</h2>
      <ul class="tips">
        <li>Äáº·t tÃªn tÃ i nguyÃªn cÃ³ tiá»n tá»‘: <code>spr_</code>, <code>obj_</code>, <code>rm_</code> Ä‘á»ƒ dá»… tÃ¬m.</li>
        <li>Giá»¯ cÃ¹ng kÃ­ch thÆ°á»›c Ã´ (vÃ­ dá»¥ 32Ã—32) cho sprite tÆ°á»ng vÃ  grid Room.</li>
        <li>Náº¿u nhÃ¢n váº­t bá»‹ káº¹t gÃ³c, giáº£m tá»‘c Ä‘á»™ xuá»‘ng 3 hoáº·c 2 Ä‘á»ƒ kiá»ƒm tra.</li>
        <li>Test thÆ°á»ng xuyÃªn: thá»­ Ä‘i sÃ¡t tÆ°á»ng, cháº¡m báº«y/Ä‘Ã­ch Ä‘á»ƒ kiá»ƒm tra logic.</li>
      </ul>
    </section>

    <!-- 8) TÃ³m táº¯t -->
    <section class="card">
      <h2>8) ğŸ¯ TÃ³m táº¯t buá»•i há»c</h2>
      <p>Trong buá»•i há»c nÃ y, chÃºng ta Ä‘Ã£ há»c Ä‘Æ°á»£c:</p>
      <ul class="tips">
        <li>âœ… Dá»±ng mÃª cung báº±ng <strong>Tileset</strong>, sáº¯p xáº¿p bá»‘ cá»¥c trong <strong>Room</strong>.</li>
        <li>âœ… Di chuyá»ƒn nhÃ¢n váº­t mÆ°á»£t mÃ  vá»›i <code>place_meeting()</code> Ä‘á»ƒ trÃ¡nh xuyÃªn tÆ°á»ng.</li>
        <li>âœ… Xá»­ lÃ½ <strong>va cháº¡m</strong> Ä‘á»ƒ táº¡o Ä‘iá»u kiá»‡n <em>tháº¯ng/thua</em>.</li>
      </ul>
      <p><strong>BÃ i táº­p vá» nhÃ :</strong> Táº¡o thÃªm 1 báº£n Ä‘á»“ mÃª cung má»›i khÃ³ hÆ¡n; thÃªm 1 loáº¡i báº«y (vÃ­ dá»¥ báº«y chuyá»ƒn Ä‘á»™ng) vÃ  chá»‰nh tá»‘c Ä‘á»™ cho cÃ¢n báº±ng.</p>
    </section>

    <!-- Navigation -->
    <nav class="lesson-nav">
      <a href="lesson3.html" class="nav-link">â† Buá»•i 3: Top-Down Shooter cÆ¡ báº£n</a>
      <a href="lesson5.html" class="nav-link">Buá»•i 5: Platformer cÆ¡ báº£n â†’</a>
    </nav>
  </main>
</body>
</html>
